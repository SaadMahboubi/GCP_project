apiVersion: batch/v1
kind: CronJob
metadata:
  name: bigquery-cronjob
spec:
  schedule: "*/10 * * * *"  # ExÃ©cution toutes les 10 minutes
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: bigquery-sa  # ðŸ”¹ Utiliser un Service Account GCP avec accÃ¨s BigQuery
          containers:
          - name: bigquery-runner
            image: google/cloud-sdk:latest  # ðŸ”¹ Conteneur officiel de Google avec `bq` installÃ©
            command:
              - "/bin/sh"
              - "-c"
              - |
                bq query --use_legacy_sql=false "
                SELECT COUNT(*) as row_count FROM `infra-core-453416-a1.test_saad.table_test`;
                "
          restartPolicy: OnFailure
